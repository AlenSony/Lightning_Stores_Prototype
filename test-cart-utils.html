<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Utility Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .test-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .test-controls {
            margin-bottom: 20px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        .test-output {
            background-color: #222;
            color: #f1f1f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .info {
            color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>Cart Utility Function Tests</h1>
    
    <div class="test-container">
        <h2>About This Test</h2>
        <p>This page tests the cart utility functions that handle adding, removing, updating quantities, and calculating totals for the shopping cart. The tests will use localStorage to simulate cart operations.</p>
        <p><strong>Note:</strong> Running these tests will clear any existing cart data in localStorage.</p>
    </div>
    
    <div class="test-controls">
        <button id="runTests">Run Tests</button>
        <button id="clearConsole">Clear Console</button>
    </div>
    
    <div class="test-output" id="testOutput"></div>
    
    <script type="module">
        // Override console.log to display in both console and on the page
        const originalConsoleLog = console.log;
        const testOutput = document.getElementById('testOutput');
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            
            // Format the output for display
            let output = '';
            args.forEach(arg => {
                if (typeof arg === 'object' && arg !== null) {
                    output += JSON.stringify(arg, null, 2) + '\n';
                } else {
                    // Add color based on content
                    if (arg.toString().includes('✓')) {
                        output += `<span class="success">${arg}</span>\n`;
                    } else if (arg.toString().includes('Error')) {
                        output += `<span class="error">${arg}</span>\n`;
                    } else {
                        output += `<span class="info">${arg}</span>\n`;
                    }
                }
            });
            
            testOutput.innerHTML += output + '\n';
            testOutput.scrollTop = testOutput.scrollHeight;
        };
        
        // Mock utility functions directly in the browser since we can't import them
        const cartUtils = {
            // Add item to cart
            addToCart: function(itemData) {
                try {
                    // Create the item object with necessary properties
                    const cartItem = {
                        id: `${itemData.name}-${Date.now()}`, // Generate a unique ID
                        name: itemData.name,
                        company: itemData.company,
                        price: parseFloat(itemData.price),
                        description: itemData.description,
                        ram: itemData.ram,
                        storage: itemData.storage,
                        image: itemData.image,
                        quantity: 1,
                        basePrice: parseFloat(itemData.price) // Store base price for quantity changes
                    };
                    
                    // Get existing cart or create new
                    let cart = this.getCart();
                    
                    // Add the new item
                    cart.push(cartItem);
                    
                    // Save back to localStorage
                    localStorage.setItem('cart', JSON.stringify(cart));
                    
                    return {
                        success: true,
                        message: `${itemData.name} has been added to your cart!`,
                        item: cartItem,
                        cart: cart
                    };
                } catch (error) {
                    console.error('Error adding to cart:', error);
                    return {
                        success: false,
                        message: 'Failed to add item to cart. Please try again.',
                        error: error.message
                    };
                }
            },
            
            // Get cart items
            getCart: function() {
                try {
                    const savedCart = localStorage.getItem('cart');
                    return savedCart ? JSON.parse(savedCart) : [];
                } catch (error) {
                    console.error('Error getting cart:', error);
                    return [];
                }
            },
            
            // Remove item from cart
            removeFromCart: function(itemId) {
                try {
                    let cart = this.getCart();
                    const updatedCart = cart.filter(item => item.id !== itemId);
                    localStorage.setItem('cart', JSON.stringify(updatedCart));
                    
                    return {
                        success: true,
                        message: 'Item removed from cart',
                        cart: updatedCart,
                        total: this.calculateTotal(updatedCart)
                    };
                } catch (error) {
                    console.error('Error removing from cart:', error);
                    return {
                        success: false,
                        message: 'Failed to remove item from cart',
                        error: error.message
                    };
                }
            },
            
            // Update item quantity
            updateItemQuantity: function(itemId, change) {
                try {
                    let cart = this.getCart();
                    const updatedCart = cart.map(item => {
                        if (item.id === itemId) {
                            const newQuantity = (item.quantity || 1) + change;
                            if (newQuantity < 1) return null; // Remove item if quantity becomes 0
                            
                            return {
                                ...item,
                                quantity: newQuantity,
                                price: (item.basePrice || item.price) * newQuantity
                            };
                        }
                        return item;
                    }).filter(Boolean);
                    
                    localStorage.setItem('cart', JSON.stringify(updatedCart));
                    
                    return {
                        success: true,
                        message: 'Quantity updated',
                        cart: updatedCart,
                        total: this.calculateTotal(updatedCart)
                    };
                } catch (error) {
                    console.error('Error updating quantity:', error);
                    return {
                        success: false,
                        message: 'Failed to update quantity',
                        error: error.message
                    };
                }
            },
            
            // Calculate total price
            calculateTotal: function(cartItems) {
                try {
                    return cartItems.reduce((sum, item) => sum + item.price, 0);
                } catch (error) {
                    console.error('Error calculating total:', error);
                    return 0;
                }
            },
            
            // Clear cart
            clearCart: function() {
                try {
                    localStorage.removeItem('cart');
                    return [];
                } catch (error) {
                    console.error('Error clearing cart:', error);
                    return this.getCart(); // Return current cart if clear fails
                }
            }
        };
        
        // Run tests function
        function runCartTests() {
            console.log('Starting cart utility tests...\n');
            
            // Clear cart before tests
            cartUtils.clearCart();
            console.log('✓ Cart cleared');
            
            // Test 1: Add items to cart
            const item1 = {
                name: 'Test Laptop',
                company: 'Test Company',
                price: '1299.99',
                description: 'A test laptop',
                ram: '16GB',
                storage: '512GB SSD',
                image: 'https://via.placeholder.com/100'
            };
            
            const item2 = {
                name: 'Test Phone',
                company: 'Test Brand',
                price: '699.99',
                description: 'A test phone',
                ram: '8GB',
                storage: '256GB',
                image: 'https://via.placeholder.com/100'
            };
            
            const result1 = cartUtils.addToCart(item1);
            const result2 = cartUtils.addToCart(item2);
            
            console.log('\n✓ Items added to cart');
            console.log('  - First item result:', result1.message);
            console.log('  - Second item result:', result2.message);
            
            // Test 2: Get cart items
            const cart = cartUtils.getCart();
            console.log('\n✓ Cart retrieved');
            console.log('  - Number of items:', cart.length);
            console.log('  - Cart contents:', cart);
            
            // Test 3: Calculate total
            const total = cartUtils.calculateTotal(cart);
            console.log('\n✓ Total calculated');
            console.log('  - Total price: $' + total.toFixed(2));
            
            // Test 4: Update quantity
            if (cart.length > 0) {
                const itemId = cart[0].id;
                const updateResult = cartUtils.updateItemQuantity(itemId, 1); // Increase quantity by 1
                console.log('\n✓ Quantity updated');
                console.log('  - Updated cart:', updateResult.cart);
                console.log('  - New total: $' + updateResult.total.toFixed(2));
                
                // Test 5: Remove item
                const removeResult = cartUtils.removeFromCart(itemId);
                console.log('\n✓ Item removed');
                console.log('  - Cart after removal:', removeResult.cart);
                console.log('  - Total after removal: $' + removeResult.total.toFixed(2));
            }
            
            // Test 6: Clear cart
            const emptyCart = cartUtils.clearCart();
            console.log('\n✓ Cart cleared');
            console.log('  - Empty cart:', emptyCart);
            console.log('\nTests completed!');
        }
        
        // Event listeners
        document.getElementById('runTests').addEventListener('click', runCartTests);
        document.getElementById('clearConsole').addEventListener('click', function() {
            testOutput.innerHTML = '';
        });
    </script>
</body>
</html>